# link-checking-service
Сервис проверки доступности ссылок и генерации отчетов.

В данном репозитории реализован сервис для проверки списка URL-адресов на доступность. Реализован на Go 1.23, поддерживает конкурентную проверку, сохранение состояния и генерацию PDF-отчетов.

## Запуск приложения
Для запуска приложения выполните команду:
```bash
go run cmd/app/main.go
```
После запуска сервис будет доступен на: http://localhost:8080.

## API

### Endpoints

- `POST /getjson` - проверить ссылки и получить результат в JSON.
  - Body: `{"links": ["https://google.com", "https://example.com"]}`
- `POST /getpdf` - проверить ссылки и скачать PDF отчет.
  - Body: `{"links": ["https://google.com", "https://example.com"]}`

## Архитектура приложения

Архитектура проекта следует принципам Clean Architecture:

├── cmd
│   └── app
│       └── main.go                    # точка входа в приложение
│
├── dto                                # Data Transfer Objects
│
├── internal
│   ├── app
│   │   └── app.go                     # сборка зависимостей, запуск сервера
│   │
│   ├── handler                        # HTTP-слой
│   │   ├── routers-links.go           # хендлеры для ссылок
│   │   └── mappers.go                 # маппинг DTO
│   │
│   └── links                          # бизнес-логика и хранение
│       ├── service.go                 # логика проверки ссылок и генерации PDF
│       ├── storage.go                 # внутреннее хранилище с TTL и сохранением в файл
│       ├── models.go                  # модель информации о ссылке
│       └── repository.go              # интерфейс репозитория
│
└── storage.json                       # файл сгенерируется после первого завершения сервера

## Технические решения

### Конкурентность
Проверка ссылок выполняется конкурентно с использованием `sync.WaitGroup`, таким образом ускоряя обработку больших списков URL. Также добавлена проверка на валидность URL-адресов, однако сделано допущение, что проверяться будут только хосты, а не конкретные страницы.

### Хранение данных
Используется внутреннее in-memory хранилище (`map`) с Time-To-Live в 60 секунд.
- при запросе данных, если они устарели, происходит повторная проверка.
- при shutdown данные сохраняются в файл `storage.json`.
- при запуске данные подгружаются из файла, решая таким образом проблему сохранения состояния при рестарте сервера.

### Генерация PDF
Для создания отчетов используется библиотека `github.com/go-pdf/fpdf`.

## Ход решения

### Использование DTO и идентификаторы ссылок
Изначально при чтении задания я подумал, что для каждой ссылки потребуется свой собственный номер, а не только общий идентификатор группы (`links_num`).
Из-за этого я начал добавлять в модель инфромации о ссылке поле `LinkNum` и строить вокруг него маппинг DTO, так как хотел показать применение паттерна DTO.
Позже, когда до конца разобрался в логике, понял, что номер ссылки сам по себе нигде не используется — нужен только идентификатор группы ссылок (`links_num`), который возвращает `/getjson`.
Однако в таком случае паттерн DTO был бы избыточным, поэтому решил не убирать поле `LinkNum` и оставить DTO для передачи данных между слоями.

Поэтому было принято решение оставить `LinkNum`, который просто инкрементируется внутри набора ссылок, и использовать его исключительно как элемент структуры, чтобы не "выкидывать" паттерн.

## Вывод

Таким образом, реализован полноценный сервис, который:

- корректно обрабатывает ввод и валидирует URL
- кеширует результаты с поддержкой TTL и восстановления после перезапуска
- формирует PDF-отчёты
- поддерживает корректный graceful shutdown
- имеет чистую архитектуру и читаемость кода.